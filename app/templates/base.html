<!DOCTYPE html>
<html lang="ar" class="h-full" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}إدارة المخزون والفواتير{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'cairo': ['Cairo', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        secondary: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        
        /* Loader Styles */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: all 0.3s ease-out;
            opacity: 1;
        }
        
        .dark .loader {
            background: rgba(17, 24, 39, 0.95);
        }
        
        .loader.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            position: relative;
            animation: spin 1.2s linear infinite;
        }
        
        .spinner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 4px solid transparent;
            border-top: 4px solid #3b82f6;
            border-right: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1.2s linear infinite;
        }
        
        .spinner::after {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            width: calc(100% - 16px);
            height: calc(100% - 16px);
            border: 3px solid transparent;
            border-top: 3px solid #60a5fa;
            border-radius: 50%;
            animation: spin 0.8s linear infinite reverse;
        }
        
        .dark .spinner::before {
            border-top: 4px solid #60a5fa;
            border-right: 4px solid #60a5fa;
        }
        
        .dark .spinner::after {
            border-top: 3px solid #93c5fd;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Pulse animation for the logo */
        .loader-logo {
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                opacity: 1;
            }
            50% { 
                transform: scale(1.1);
                opacity: 0.8;
            }
        }
        
        /* Fade in animation for loader text */
        .loader-text {
            animation: fadeInUp 0.5s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .loader-content {
            text-align: center;
            animation: loaderContentFadeIn 0.6s ease-out;
        }
        
        @keyframes loaderContentFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .loader-text {
            margin-top: 16px;
            font-size: 16px;
            font-weight: 500;
            color: #374151;
            font-family: 'Cairo', sans-serif;
        }
        
        .dark .loader-text {
            color: #d1d5db;
        }
        
        .loader-logo {
            font-size: 24px;
            margin-bottom: 8px;
            color: #3b82f6;
        }
        
        .dark .loader-logo {
            color: #60a5fa;
        }
        
        /* Loading dots animation */
        .loader-dots {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 12px;
            gap: 4px;
        }
        
        .loader-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #3b82f6;
            animation: dots 1.4s ease-in-out infinite both;
        }
        
        .dark .loader-dots span {
            background-color: #60a5fa;
        }
        
        .loader-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }
        
        .loader-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }
        
        .loader-dots span:nth-child(3) {
            animation-delay: 0s;
        }
        
        @keyframes dots {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1.2);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <!-- Loader -->
    <div id="pageLoader" class="loader">
        <div class="loader-content">
            <div class="loader-logo">Stockly</div>
            <div class="spinner"></div>
            <div class="loader-text">جاري التحميل...</div>
            <div class="loader-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>
    
    <!-- Navigation -->
    <nav class="navbar sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-primary-500 to-primary-600 rounded-lg flex items-center justify-center m-3">
                            <i class="fas fa-shopping-cart text-white text-sm"></i>
                        </div>
                        <div class="flex flex-col">
                            <h1 class="navbar-title">Stockly</h1>
                            {% if user.is_authenticated and user.company %}
                            <span class="text-xs text-gray-500 dark:text-gray-400 font-medium">
                                <i class="fas fa-building ml-1"></i>{{ user.company.name }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="hidden md:mr-6 md:flex md:space-x-8 space-x-reverse">
                        <a href="{% url 'dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                            <i class="fas fa-chart-pie ml-2"></i>
                            لوحة التحكم
                        </a>
                        <a href="{% url 'customers' %}" class="nav-link {% if request.resolver_match.url_name == 'customers' %}active{% endif %}">
                            <i class="fas fa-users ml-2"></i>
                            العملاء
                        </a>
                        <a href="{% url 'products' %}" class="nav-link {% if request.resolver_match.url_name == 'products' %}active{% endif %}">
                            <i class="fas fa-box ml-2"></i>
                            المنتجات
                        </a>
                        <a href="{% url 'categories' %}" class="nav-link {% if request.resolver_match.url_name == 'categories' %}active{% endif %}">
                            <i class="fas fa-tags ml-2"></i>
                            الفئات
                        </a>
                        <a href="{% url 'invoices' %}" class="nav-link {% if request.resolver_match.url_name == 'invoices' %}active{% endif %}">
                            <i class="fas fa-file-invoice ml-2"></i>
                            الفواتير
                        </a>
                        <a href="{% url 'user_management' %}" class="nav-link {% if request.resolver_match.url_name == 'user_management' %}active{% endif %}">
                            <i class="fas fa-users ml-2"></i>
                            إدارة المستخدمين
                        </a>
                    </div>
                </div>
                <div class="flex items-center space-x-4 space-x-reverse">
                    <!-- Dark Mode Toggle -->
                    <button id="darkModeToggle" class="btn-icon">
                        <i id="darkModeIcon" class="fas fa-moon"></i>
                    </button>
                    <!-- User Menu Dropdown -->
                    {% if user.is_authenticated %}
                    <div class="relative" id="userMenu">
                        <button onclick="toggleUserMenu()" class="btn-icon">
                            <i class="fas fa-user"></i>
                        </button>
                        <div id="userDropdown" class="hidden absolute left-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50">
                            <div class="py-2">
                                <!-- User Info -->
                                <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">
                                        {% if user.first_name %}{{ user.first_name }} {{ user.last_name }}{% else %}{{ user.username }}{% endif %}
                                    </p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">{{ user.get_account_type_display_arabic }}</p>
                                    {% if user.company %}
                                    <p class="text-xs text-primary-600 dark:text-primary-400 font-medium mt-1">
                                        <i class="fas fa-building ml-1"></i>{{ user.company.name }}
                                    </p>
                                    {% endif %}
                                </div>
                                
                                <!-- Menu Items -->
                                <a href="{% url 'user_management' %}" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i class="fas fa-users ml-3"></i>
                                    إدارة المستخدمين
                                </a>
                                <a href="{% url 'add_user' %}" class="flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <i class="fas fa-user-plus ml-3"></i>
                                    إضافة مستخدم
                                </a>
                                <div class="border-t border-gray-200 dark:border-gray-700"></div>
                                <a href="{% url 'logout' %}" class="flex items-center px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20">
                                    <i class="fas fa-sign-out-alt ml-3"></i>
                                    تسجيل الخروج
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Navigation -->
    <div class="md:hidden mobile-navbar">
        {% if user.is_authenticated and user.company %}
        <div class="px-4 py-2 bg-primary-50 dark:bg-primary-900/20 border-b border-primary-200 dark:border-primary-800">
            <div class="flex items-center text-sm text-primary-700 dark:text-primary-300">
                <i class="fas fa-building ml-2"></i>
                <span class="font-medium">{{ user.company.name }}</span>
            </div>
        </div>
        {% endif %}
        <div class="px-2 pt-2 pb-3 space-y-1">
            <a href="{% url 'dashboard' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <i class="fas fa-chart-pie ml-2"></i>
                لوحة التحكم
            </a>
            <a href="{% url 'customers' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'customers' %}active{% endif %}">
                <i class="fas fa-users ml-2"></i>
                العملاء
            </a>
            <a href="{% url 'products' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'products' %}active{% endif %}">
                <i class="fas fa-box ml-2"></i>
                المنتجات
            </a>
            <a href="{% url 'categories' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'categories' %}active{% endif %}">
                <i class="fas fa-tags ml-2"></i>
                الفئات
            </a>
            <a href="{% url 'invoices' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'invoices' %}active{% endif %}">
                <i class="fas fa-file-invoice ml-2"></i>
                الفواتير
            </a>
            <a href="{% url 'user_management' %}" class="mobile-nav-link {% if request.resolver_match.url_name == 'user_management' %}active{% endif %}">
                <i class="fas fa-users ml-2"></i>
                إدارة المستخدمين
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1">
        {% block content %}{% endblock %}
    </main>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 backdrop-blur-sm">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6 transform transition-all duration-300">
                <div class="flex items-center mb-6">
                    <div id="confirmationIcon" class="w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-question-circle text-white"></i>
                    </div>
                    <h3 id="confirmationTitle" class="text-lg font-semibold text-gray-900 dark:text-white font-cairo">تأكيد العملية</h3>
                </div>
                <p id="confirmationMessage" class="text-gray-600 dark:text-gray-400 font-cairo mb-6"></p>
                <div class="flex justify-end space-x-3 space-x-reverse">
                    <button id="confirmationCancel" class="btn-secondary">
                        <i class="fas fa-times ml-2"></i>
                        إلغاء
                    </button>
                    <button id="confirmationConfirm" class="btn-danger">
                        <i class="fas fa-check ml-2"></i>
                        تأكيد
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50 backdrop-blur-sm">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6 transform transition-all duration-300">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white font-cairo">
                        <i class="fas fa-qrcode ml-2"></i>QR Code
                    </h3>
                    <button onclick="closeQRModal()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="text-center">
                    <div id="qrCodeContainer" class="flex justify-center mb-4">
                        <canvas id="qrCanvas" class="border border-gray-200 dark:border-gray-600 rounded-lg"></canvas>
                    </div>
                    <p id="qrProductName" class="text-gray-600 dark:text-gray-400 font-cairo mb-4"></p>
                    <div class="flex justify-center space-x-3 space-x-reverse">
                        <button onclick="downloadQR()" class="btn-primary">
                            <i class="fas fa-download ml-2"></i>
                            تحميل
                        </button>
                        <button onclick="printQR()" class="btn-secondary">
                            <i class="fas fa-print ml-2"></i>
                            طباعة
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark Mode Toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = document.getElementById('darkModeIcon');
        const html = document.documentElement;

        // Check for saved theme preference or default to light mode
        const currentTheme = localStorage.getItem('theme') || 'dark';
        if (currentTheme === 'dark') {
            html.classList.add('dark');
            darkModeIcon.className = 'fas fa-sun';
        }

        darkModeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            const isDark = html.classList.contains('dark');
            darkModeIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        // Notification System
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type} notification-enhanced`;
            
            const icon = {
                success: 'fas fa-check-circle',
                error: 'fas fa-times-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            }[type] || 'fas fa-info-circle';
            
            // Enhanced styling based on type
            const typeStyles = {
                success: 'bg-gradient-to-r from-green-500 to-green-600 text-white border-green-600',
                error: 'bg-gradient-to-r from-red-500 to-red-600 text-white border-red-600',
                warning: 'bg-gradient-to-r from-yellow-500 to-orange-500 text-white border-orange-500',
                info: 'bg-gradient-to-r from-blue-500 to-blue-600 text-white border-blue-600'
            };
            
            notification.innerHTML = `
                <div class="flex items-center justify-between p-4 rounded-lg shadow-lg border-l-4 ${typeStyles[type]} transform transition-all duration-300 ease-in-out hover:scale-105">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <i class="${icon} text-xl ml-3"></i>
                        </div>
                        <div class="flex-1">
                            <span class="font-cairo text-right font-semibold text-lg">${message}</span>
                        </div>
                    </div>
                    <button onclick="closeNotification(this)" class="flex-shrink-0 text-white opacity-80 hover:opacity-100 transition-opacity duration-200 hover:bg-white hover:bg-opacity-20 rounded-full p-1">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Auto remove after duration
            setTimeout(() => {
                if (notification.parentNode) {
                    closeNotification(notification.querySelector('button'));
                }
            }, duration);
        }
        
        function closeNotification(button) {
            const notification = button.closest('.notification');
            notification.style.animation = 'slideOutRight 0.3s ease-in';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }
        
        // Confirmation Modal System
        function showConfirmation(title, message, confirmText = 'تأكيد', cancelText = 'إلغاء', type = 'warning') {
            return new Promise((resolve) => {
                const modal = document.getElementById('confirmationModal');
                const titleEl = document.getElementById('confirmationTitle');
                const messageEl = document.getElementById('confirmationMessage');
                const iconEl = document.getElementById('confirmationIcon');
                const confirmBtn = document.getElementById('confirmationConfirm');
                const cancelBtn = document.getElementById('confirmationCancel');
                
                // Set content
                titleEl.textContent = title;
                messageEl.textContent = message;
                confirmBtn.innerHTML = `<i class="fas fa-check ml-2"></i>${confirmText}`;
                cancelBtn.innerHTML = `<i class="fas fa-times ml-2"></i>${cancelText}`;
                
                // Set icon and colors based on type
                const configs = {
                    warning: {
                        icon: 'fas fa-exclamation-triangle',
                        bg: 'bg-gradient-to-r from-yellow-500 to-orange-500',
                        btnClass: 'btn-danger'
                    },
                    danger: {
                        icon: 'fas fa-trash',
                        bg: 'bg-gradient-to-r from-red-500 to-red-600',
                        btnClass: 'btn-danger'
                    },
                    info: {
                        icon: 'fas fa-info-circle',
                        bg: 'bg-gradient-to-r from-blue-500 to-blue-600',
                        btnClass: 'btn-primary'
                    },
                    success: {
                        icon: 'fas fa-check-circle',
                        bg: 'bg-gradient-to-r from-green-500 to-green-600',
                        btnClass: 'btn-success'
                    }
                };
                
                const config = configs[type] || configs.warning;
                iconEl.className = `w-10 h-10 rounded-lg flex items-center justify-center mr-3 ${config.bg}`;
                iconEl.innerHTML = `<i class="${config.icon} text-white"></i>`;
                confirmBtn.className = config.btnClass;
                
                // Show modal
                modal.classList.remove('hidden');
                
                // Event handlers
                const handleConfirm = () => {
                    modal.classList.add('hidden');
                    resolve(true);
                    cleanup();
                };
                
                const handleCancel = () => {
                    modal.classList.add('hidden');
                    resolve(false);
                    cleanup();
                };
                
                const cleanup = () => {
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                };
                
                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
            });
        }
        
        // Custom Dropdown System
        function initDropdowns() {
            document.addEventListener('click', function(e) {
                // Close all dropdowns when clicking outside
                if (!e.target.closest('.dropdown')) {
                    document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                        menu.classList.remove('show');
                        const icon = menu.previousElementSibling.querySelector('.dropdown-icon');
                        if (icon) icon.classList.remove('rotated');
                    });
                }
            });

            // Handle dropdown toggle clicks
            document.addEventListener('click', function(e) {
                const toggle = e.target.closest('.dropdown-toggle');
                if (toggle) {
                    e.preventDefault();
                    const dropdown = toggle.closest('.dropdown');
                    const menu = dropdown.querySelector('.dropdown-menu');
                    const icon = toggle.querySelector('.dropdown-icon');
                    
                    // Close other dropdowns
                    document.querySelectorAll('.dropdown-menu.show').forEach(otherMenu => {
                        if (otherMenu !== menu) {
                            otherMenu.classList.remove('show');
                            const otherIcon = otherMenu.previousElementSibling.querySelector('.dropdown-icon');
                            if (otherIcon) otherIcon.classList.remove('rotated');
                        }
                    });
                    
                    // Toggle current dropdown
                    menu.classList.toggle('show');
                    if (icon) icon.classList.toggle('rotated');
                }
            });

            // Handle dropdown item clicks
            document.addEventListener('click', function(e) {
                const item = e.target.closest('.dropdown-item');
                if (item) {
                    const dropdown = item.closest('.dropdown');
                    const toggle = dropdown.querySelector('.dropdown-toggle');
                    const menu = dropdown.querySelector('.dropdown-menu');
                    const icon = toggle.querySelector('.dropdown-icon');
                    
                    // Update selected item
                    dropdown.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    
                    // Update toggle text
                    const toggleText = toggle.querySelector('.dropdown-text');
                    if (toggleText) {
                        toggleText.textContent = item.textContent.trim();
                    }
                    
                    // Update hidden input value
                    const hiddenInput = dropdown.querySelector('input[type="hidden"]');
                    if (hiddenInput) {
                        hiddenInput.value = item.dataset.value || item.textContent.trim();
                    }
                    
                    // Close dropdown
                    menu.classList.remove('show');
                    if (icon) icon.classList.remove('rotated');
                    
                    // Trigger change event
                    const changeEvent = new Event('change', { bubbles: true });
                    dropdown.dispatchEvent(changeEvent);
                }
            });
        }

        // QR Code System
        let currentQRData = null;
        
        // Check if QR Code library is loaded
        function checkQRCodeLibrary() {
            if (typeof qrcode === 'undefined') {
                console.error('QRCode library not loaded');
                return false;
            }
            return true;
        }
        
        function generateQRCode(productId, productName, productSKU) {
            // Check if qrcode library is loaded
            if (typeof qrcode === 'undefined') {
                console.error('QRCode library not loaded');
                showNotification('مكتبة QR Code غير محملة', 'error');
                return;
            }
            
            const qrData = {
                id: productId,
                name: productName,
                sku: productSKU,
                url: `${window.location.origin}/products/${productId}/`
            };
            
            currentQRData = qrData;
            
            const canvas = document.getElementById('qrCanvas');
            const productNameEl = document.getElementById('qrProductName');
            
            if (!canvas) {
                console.error('QR Canvas not found');
                showNotification('عنصر QR Canvas غير موجود', 'error');
                return;
            }
            
            try {
                // Generate QR code using qrcode-generator library
                const qr = qrcode(0, 'M');
                qr.addData(JSON.stringify(qrData));
                qr.make();
                
                // Clear previous QR code
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Set canvas size
                const size = 200;
                canvas.width = size;
                canvas.height = size;
                
                // Get QR code matrix
                const matrix = qr.getModuleCount();
                const cellSize = size / matrix;
                
                // Draw QR code
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, size, size);
                
                ctx.fillStyle = '#000000';
                for (let row = 0; row < matrix; row++) {
                    for (let col = 0; col < matrix; col++) {
                        if (qr.isDark(row, col)) {
                            ctx.fillRect(
                                col * cellSize,
                                row * cellSize,
                                cellSize,
                                cellSize
                            );
                        }
                    }
                }
                
                productNameEl.textContent = productName;
                document.getElementById('qrModal').classList.remove('hidden');
                console.log('QR Code generated successfully');
                
            } catch (error) {
                console.error('QR Code generation error:', error);
                showNotification('خطأ في إنشاء QR Code: ' + error.message, 'error');
            }
        }
        
        function closeQRModal() {
            document.getElementById('qrModal').classList.add('hidden');
            currentQRData = null;
        }
        
        function downloadQR() {
            if (!currentQRData) return;
            
            const canvas = document.getElementById('qrCanvas');
            const link = document.createElement('a');
            link.download = `QR_${currentQRData.sku}_${currentQRData.name}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            showNotification('تم تحميل QR Code بنجاح', 'success');
        }
        
        function printQR() {
            if (!currentQRData) return;
            
            const canvas = document.getElementById('qrCanvas');
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>QR Code - ${currentQRData.name}</title>
                        <style>
                            body { 
                                font-family: 'Cairo', sans-serif; 
                                text-align: center; 
                                padding: 20px;
                                direction: rtl;
                            }
                            .qr-container { 
                                margin: 20px 0; 
                            }
                            .product-info {
                                margin: 20px 0;
                                font-size: 18px;
                            }
                        </style>
                    </head>
                    <body>
                        <h1>QR Code للمنتج</h1>
                        <div class="product-info">
                            <p><strong>الاسم:</strong> ${currentQRData.name}</p>
                            <p><strong>SKU:</strong> ${currentQRData.sku}</p>
                        </div>
                        <div class="qr-container">
                            <img src="${canvas.toDataURL()}" alt="QR Code" style="max-width: 300px;">
                        </div>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            
            showNotification('تم إرسال QR Code للطباعة', 'success');
        }

        // User Menu Dropdown
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('hidden');
        }

        // Close user menu when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('userMenu');
            const dropdown = document.getElementById('userDropdown');
            
            if (!userMenu.contains(event.target)) {
                dropdown.classList.add('hidden');
            }
        });

        // Enhanced notification messages
        function showSuccessNotification(message) {
            showNotification(`✅ ${message}`, 'success');
            playNotificationSound('success');
            addToHistory(message, 'success', new Date());
            updateNotificationStats('success');
        }
        
        function showErrorNotification(message) {
            showNotification(`❌ ${message}`, 'error');
            playNotificationSound('error');
            addToHistory(message, 'error', new Date());
            updateNotificationStats('error');
        }
        
        function showWarningNotification(message) {
            showNotification(`⚠️ ${message}`, 'warning');
            playNotificationSound('warning');
            addToHistory(message, 'warning', new Date());
            updateNotificationStats('warning');
        }
        
        function showInfoNotification(message) {
            showNotification(`ℹ️ ${message}`, 'info');
            playNotificationSound('info');
            addToHistory(message, 'info', new Date());
            updateNotificationStats('info');
        }

        // Global functions for easy access
        window.showNotification = showNotification;
        window.showSuccessNotification = showSuccessNotification;
        window.showErrorNotification = showErrorNotification;
        window.showWarningNotification = showWarningNotification;
        window.showInfoNotification = showInfoNotification;
        window.showConfirmation = showConfirmation;
        window.closeNotification = closeNotification;
        window.initDropdowns = initDropdowns;
        window.generateQRCode = generateQRCode;
        window.closeQRModal = closeQRModal;
        window.downloadQR = downloadQR;
        window.printQR = printQR;
        window.checkQRCodeLibrary = checkQRCodeLibrary;
        window.toggleUserMenu = toggleUserMenu;
        window.queueNotification = queueNotification;
        window.playNotificationSound = playNotificationSound;
        window.addToHistory = addToHistory;
        window.getNotificationHistory = getNotificationHistory;
        window.clearNotificationHistory = clearNotificationHistory;
        window.updateNotificationStats = updateNotificationStats;
        window.getNotificationStats = getNotificationStats;
        window.resetNotificationStats = resetNotificationStats;
        window.updateNotificationPreferences = updateNotificationPreferences;
        window.getNotificationPreferences = getNotificationPreferences;
        
        // Auto-refresh for real-time updates
        // {% block auto_refresh %}{% endblock %}
        
        // Show welcome message on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Show a subtle welcome message
            setTimeout(() => {
                if (window.location.pathname === '/') {
                    showInfoNotification('مرحباً بك في نظام إدارة المخزون Stockly');
                }
            }, 1000);
        });
        
        // Add notification preferences
        let notificationPreferences = {
            sound: true,
            duration: 5000,
            position: 'top-right',
            maxVisible: 5
        };
        
        function updateNotificationPreferences(prefs) {
            notificationPreferences = { ...notificationPreferences, ...prefs };
        }
        
        function getNotificationPreferences() {
            return notificationPreferences;
        }
        
        // Add notification history
        let notificationHistory = [];
        const MAX_HISTORY = 50;
        
        function addToHistory(message, type, timestamp) {
            notificationHistory.unshift({ message, type, timestamp });
            if (notificationHistory.length > MAX_HISTORY) {
                notificationHistory.pop();
            }
        }
        
        function getNotificationHistory() {
            return notificationHistory;
        }
        
        function clearNotificationHistory() {
            notificationHistory = [];
        }
        
        // Add keyboard shortcuts for notifications
        document.addEventListener('keydown', function(e) {
            // Ctrl + Shift + S for success notification
            if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                e.preventDefault();
                showSuccessNotification('هذه رسالة نجاح تجريبية');
            }
            // Ctrl + Shift + E for error notification
            if (e.ctrlKey && e.shiftKey && e.key === 'E') {
                e.preventDefault();
                showErrorNotification('هذه رسالة خطأ تجريبية');
            }
            // Ctrl + Shift + W for warning notification
            if (e.ctrlKey && e.shiftKey && e.key === 'W') {
                e.preventDefault();
                showWarningNotification('هذه رسالة تحذير تجريبية');
            }
            // Ctrl + Shift + I for info notification
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                showInfoNotification('هذه رسالة معلومات تجريبية');
            }
        });
        
        // Add sound effects for notifications (optional)
        function playNotificationSound(type) {
            if (!notificationPreferences.sound) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Different frequencies for different notification types
                const frequencies = {
                    success: 800,
                    error: 400,
                    warning: 600,
                    info: 500
                };
                
                oscillator.frequency.setValueAtTime(frequencies[type] || 500, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Audio not supported or user hasn't interacted with page
                console.log('Audio notification not available');
            }
        }
        
        // Add notification queue system
        let notificationQueue = [];
        let isProcessingQueue = false;
        
        function queueNotification(message, type, duration) {
            notificationQueue.push({ message, type, duration });
            if (!isProcessingQueue) {
                processNotificationQueue();
            }
        }
        
        function processNotificationQueue() {
            if (notificationQueue.length === 0) {
                isProcessingQueue = false;
                return;
            }
            
            isProcessingQueue = true;
            const notification = notificationQueue.shift();
            showNotification(notification.message, notification.type, notification.duration || notificationPreferences.duration);
            
            // Process next notification after a delay
            setTimeout(() => {
                processNotificationQueue();
            }, 1000);
        }
        
        // Add notification statistics
        let notificationStats = {
            success: 0,
            error: 0,
            warning: 0,
            info: 0,
            total: 0
        };
        
        function updateNotificationStats(type) {
            notificationStats[type]++;
            notificationStats.total++;
        }
        
        function getNotificationStats() {
            return notificationStats;
        }
        
        function resetNotificationStats() {
            notificationStats = {
                success: 0,
                error: 0,
                warning: 0,
                info: 0,
                total: 0
            };
        }
        
        // Add notification analytics
        function getNotificationAnalytics() {
            const stats = getNotificationStats();
            const history = getNotificationHistory();
            
            return {
                stats,
                history,
                preferences: getNotificationPreferences(),
                queueLength: notificationQueue.length,
                isProcessing: isProcessingQueue
            };
        }
    </script>
    
    <!-- Loader Management -->
    <script>
        // Global loader management
        window.PageLoader = {
            show: function(text = 'جاري التحميل...') {
                const loader = document.getElementById('pageLoader');
                const loaderText = loader.querySelector('.loader-text');
                const loaderDots = loader.querySelector('.loader-dots');
                
                if (loaderText) {
                    loaderText.textContent = text;
                }
                
                // Reset animations
                loader.style.display = 'flex';
                loader.classList.remove('hidden');
                
                // Add entrance animation
                setTimeout(() => {
                    loader.style.opacity = '1';
                }, 10);
            },
            
            hide: function() {
                const loader = document.getElementById('pageLoader');
                
                // Add exit animation
                loader.style.opacity = '0';
                
                setTimeout(() => {
                    loader.classList.add('hidden');
                    loader.style.display = 'none';
                }, 300);
            },
            
            setText: function(text) {
                const loader = document.getElementById('pageLoader');
                const loaderText = loader.querySelector('.loader-text');
                if (loaderText) {
                    // Add fade effect when changing text
                    loaderText.style.opacity = '0.5';
                    setTimeout(() => {
                        loaderText.textContent = text;
                        loaderText.style.opacity = '1';
                    }, 150);
                }
            },
            
            showProgress: function(progress) {
                const loader = document.getElementById('pageLoader');
                const loaderText = loader.querySelector('.loader-text');
                if (loaderText) {
                    loaderText.textContent = `جاري التحميل... ${progress}%`;
                }
            }
        };
        
        // Show loader on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loader after a short delay to ensure page is fully loaded
            setTimeout(() => {
                PageLoader.hide();
            }, 500);
        });
        
        // Show loader on page unload
        window.addEventListener('beforeunload', function() {
            PageLoader.show('جاري الانتقال...');
        });

        // Store auth token in localStorage for API calls
        // {% if user.is_authenticated %}
            // Get token from Django session or create one
            fetch('/api/get-token/', {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                if (data.token) {
                    localStorage.setItem('authToken', data.token);
                    console.log('Token saved to localStorage:', data.token);
                }
            })
            .catch(error => {
                console.error('Error getting token:', error);
            });
        // {% endif %}
        
        // Helper function to get auth token
        function getAuthToken() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                console.error('No auth token found in localStorage');
                // Try to get token again
                fetch('/api/get-token/', {
                    method: 'GET'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.token) {
                        localStorage.setItem('authToken', data.token);
                        console.log('Token retrieved and saved:', data.token);
                    }
                })
                .catch(error => {
                    console.error('Error getting token:', error);
                });
            }
            return token;
        }
    </script>
</body>
</html>

<style>
.nav-link {
    display: inline-flex !important; /* inline-flex */
    align-items: center !important; /* items-center */
    padding: 0.5rem 0.75rem !important; /* px-3 py-2 */
    font-size: 0.875rem !important; /* text-sm */
    font-weight: 500 !important; /* font-medium */
    color: #4b5563 !important; /* text-gray-600 */
    border-radius: 0.5rem !important; /* rounded-lg */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    text-decoration: none !important;
}

.nav-link:hover {
    color: #111827 !important; /* hover:text-gray-900 */
    background-color: #f3f4f6 !important; /* hover:bg-gray-100 */
}

.dark .nav-link {
    color: #d1d5db !important; /* dark:text-gray-300 */
}

.dark .nav-link:hover {
    color: #ffffff !important; /* dark:hover:text-white */
    background-color: #374151 !important; /* dark:hover:bg-gray-700 */
}

.nav-link.active {
    color: #2563eb !important; /* text-primary-600 */
    background-color: #eff6ff !important; /* bg-primary-50 */
    border-right: 4px solid #2563eb !important; /* border-r-4 border-primary-600 */
}

.dark .nav-link.active {
    color: #60a5fa !important; /* dark:text-primary-400 */
    background-color: rgba(30, 58, 138, 0.2) !important; /* dark:bg-primary-900/20 */
    border-right-color: #60a5fa !important; /* dark:border-primary-400 */
}

.mobile-nav-link {
    display: block !important; /* block */
    padding: 0.5rem 0.75rem !important; /* px-3 py-2 */
    font-size: 1rem !important; /* text-base */
    font-weight: 500 !important; /* font-medium */
    color: #4b5563 !important; /* text-gray-600 */
    border-radius: 0.375rem !important; /* rounded-md */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    text-decoration: none !important;
}

.mobile-nav-link:hover {
    color: #111827 !important; /* hover:text-gray-900 */
    background-color: #f9fafb !important; /* hover:bg-gray-50 */
}

.dark .mobile-nav-link {
    color: #d1d5db !important; /* dark:text-gray-300 */
}

.dark .mobile-nav-link:hover {
    color: #ffffff !important; /* dark:hover:text-white */
    background-color: #374151 !important; /* dark:hover:bg-gray-700 */
}

.mobile-nav-link.active {
    color: #2563eb !important; /* text-primary-600 */
    background-color: #eff6ff !important; /* bg-primary-50 */
    border-right: 4px solid #2563eb !important; /* border-r-4 border-primary-600 */
}

.dark .mobile-nav-link.active {
    color: #60a5fa !important; /* dark:text-primary-400 */
    background-color: rgba(30, 58, 138, 0.2) !important; /* dark:bg-primary-900/20 */
    border-right-color: #60a5fa !important; /* dark:border-primary-400 */
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    @apply bg-gray-100 dark:bg-gray-800;
}

::-webkit-scrollbar-thumb {
    @apply bg-gray-300 dark:bg-gray-600 rounded-full;
}

::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400 dark:bg-gray-500;
}

/* Button Styles */
.btn-primary {
    @apply px-6 py-3 bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white rounded-lg font-cairo font-medium transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5 flex items-center justify-center;
}

.btn-secondary {
    @apply px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg font-cairo font-medium transition-all duration-200 hover:shadow-md flex items-center justify-center;
}

.btn-danger {
    @apply px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg font-cairo font-medium transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5 flex items-center justify-center;
}

.btn-success {
    @apply px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-cairo font-medium transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5 flex items-center justify-center;
}

.btn-icon {
    @apply p-2 rounded-lg border border-secondary text-secondary hover:bg-secondary transition-all duration-200 hover:scale-105;
}

/* Enhanced Notification Styles */
.notification {
    @apply mb-4 transform transition-all duration-300 ease-in-out;
    animation: slideInRight 0.4s ease-out;
}

.notification-enhanced {
    @apply rounded-xl shadow-2xl border-l-4 backdrop-blur-sm;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

.notification-enhanced:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}

/* Success Notification - Green Gradient */
.notification.success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border-left-color: #047857;
    color: white;
}

.notification.success .fas {
    color: #d1fae5;
}

/* Error Notification - Red Gradient */
.notification.error {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    border-left-color: #b91c1c;
    color: white;
}

.notification.error .fas {
    color: #fecaca;
}

/* Warning Notification - Orange Gradient */
.notification.warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    border-left-color: #b45309;
    color: white;
}

.notification.warning .fas {
    color: #fef3c7;
}

/* Info Notification - Blue Gradient */
.notification.info {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    border-left-color: #1d4ed8;
    color: white;
}

.notification.info .fas {
    color: #dbeafe;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

/* Text Color System - Control all text colors from here */
.text-primary {
    color: #111827 !important; /* text-gray-900 */
}

.dark .text-primary {
    color: #ffffff !important; /* text-white */
}

.text-secondary {
    color: #4b5563 !important; /* text-gray-600 */
}

.dark .text-secondary {
    color: #9ca3af !important; /* text-gray-400 */
}

.text-muted {
    color: #6b7280 !important; /* text-gray-500 */
}

.text-accent {
    color: #2563eb !important; /* text-primary-600 */
}

.dark .text-accent {
    color: #60a5fa !important; /* text-primary-400 */
}

.text-success {
    color: #059669 !important; /* text-green-600 */
}

.dark .text-success {
    color: #4ade80 !important; /* text-green-400 */
}

.text-warning {
    color: #d97706 !important; /* text-yellow-600 */
}

.dark .text-warning {
    color: #fbbf24 !important; /* text-yellow-400 */
}

.text-danger {
    color: #dc2626 !important; /* text-red-600 */
}

.dark .text-danger {
    color: #f87171 !important; /* text-red-400 */
}

.text-info {
    color: #2563eb !important; /* text-blue-600 */
}

.dark .text-info {
    color: #60a5fa !important; /* text-blue-400 */
}

/* Background Color System */
.bg-primary {
    background-color: #ffffff !important; /* bg-white */
}

.dark .bg-primary {
    background-color: #1f2937 !important; /* bg-gray-800 */
}

.bg-secondary {
    background-color: #f9fafb !important; /* bg-gray-50 */
}

.dark .bg-secondary {
    background-color: #374151 !important; /* bg-gray-700 */
}

.bg-muted {
    background-color: #f3f4f6 !important; /* bg-gray-100 */
}

.dark .bg-muted {
    background-color: #4b5563 !important; /* bg-gray-600 */
}

.bg-accent {
    background-color: #eff6ff !important; /* bg-primary-50 */
}

.dark .bg-accent {
    background-color: rgba(30, 58, 138, 0.2) !important; /* bg-primary-900/20 */
}

/* Border Color System */
.border-primary {
    border-color: #e5e7eb !important; /* border-gray-200 */
}

.dark .border-primary {
    border-color: #374151 !important; /* border-gray-700 */
}

.border-secondary {
    border-color: #d1d5db !important; /* border-gray-300 */
}

.dark .border-secondary {
    border-color: #4b5563 !important; /* border-gray-600 */
}

/* Input System */
.input-primary {
    padding: 0.75rem 1rem !important; /* px-4 py-3 */
    border: 1px solid #d1d5db !important; /* border border-gray-300 */
    border-radius: 0.5rem !important; /* rounded-lg */
    outline: none !important; /* focus:outline-none */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    color: #111827 !important; /* text-primary */
}

.input-primary:focus {
    border-color: #3b82f6 !important; /* focus:ring-primary-500 */
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important; /* focus:ring-2 focus:ring-primary-500 */
}

.dark .input-primary {
    border-color: #4b5563 !important; /* dark:border-gray-600 */
    background-color: #374151 !important; /* dark:bg-gray-700 */
    color: #ffffff !important; /* dark:text-white */
}

/* Custom Dropdown System */
.dropdown {
    position: relative !important;
    display: inline-block !important;
    width: 100% !important;
}

.dropdown-toggle {
    width: 100% !important;
    padding: 0.75rem 1rem !important; /* px-4 py-3 */
    border: 1px solid #d1d5db !important; /* border border-gray-300 */
    border-radius: 0.5rem !important; /* rounded-lg */
    outline: none !important; /* focus:outline-none */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    display: flex !important; /* flex */
    align-items: center !important; /* items-center */
    justify-content: space-between !important; /* justify-between */
    cursor: pointer !important; /* cursor-pointer */
    color: #111827 !important; /* text-primary */
    background-color: #ffffff !important; /* bg-white */
}

.dropdown-toggle:hover {
    background-color: #f9fafb !important; /* hover:bg-gray-50 */
}

.dropdown-toggle:focus {
    border-color: #3b82f6 !important; /* focus:ring-primary-500 */
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important; /* focus:ring-2 focus:ring-primary-500 */
}

.dark .dropdown-toggle {
    border-color: #4b5563 !important; /* dark:border-gray-600 */
    background-color: #374151 !important; /* dark:bg-gray-700 */
    color: #ffffff !important; /* dark:text-white */
}

.dark .dropdown-toggle:hover {
    background-color: #4b5563 !important; /* dark:hover:bg-gray-600 */
}

.dropdown-menu {
    position: absolute !important; /* absolute */
    z-index: 50 !important; /* z-50 */
    width: 100% !important; /* w-full */
    margin-top: 0.25rem !important; /* mt-1 */
    background-color: #ffffff !important; /* bg-white */
    border: 1px solid #e5e7eb !important; /* border border-gray-200 */
    border-radius: 0.5rem !important; /* rounded-lg */
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important; /* shadow-lg */
    display: none !important; /* hidden */
    max-height: 200px !important;
    overflow-y: auto !important;
}

.dark .dropdown-menu {
    background-color: #1f2937 !important; /* dark:bg-gray-800 */
    border-color: #374151 !important; /* dark:border-gray-700 */
}

.dropdown-menu.show {
    display: block !important; /* block */
}

.dropdown-item {
    padding: 0.75rem 1rem !important; /* px-4 py-3 */
    font-size: 0.875rem !important; /* text-sm */
    color: #374151 !important; /* text-gray-700 */
    cursor: pointer !important; /* cursor-pointer */
    transition: all 0.2s ease !important; /* transition-colors duration-200 */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    display: flex !important; /* flex */
    align-items: center !important; /* items-center */
}

.dropdown-item:hover {
    background-color: #f3f4f6 !important; /* hover:bg-gray-100 */
    color: #111827 !important; /* hover:text-gray-900 */
}

.dark .dropdown-item {
    color: #d1d5db !important; /* dark:text-gray-300 */
}

.dark .dropdown-item:hover {
    background-color: #374151 !important; /* dark:hover:bg-gray-700 */
    color: #ffffff !important; /* dark:hover:text-white */
}

.dropdown-item.selected {
    background-color: #eff6ff !important; /* bg-primary-50 */
    color: #2563eb !important; /* text-primary-600 */
}

.dark .dropdown-item.selected {
    background-color: rgba(30, 58, 138, 0.2) !important; /* dark:bg-primary-900/20 */
    color: #60a5fa !important; /* dark:text-primary-400 */
}

.dropdown-icon {
    color: #9ca3af !important; /* text-gray-400 */
    transition: transform 0.2s ease !important; /* transition-transform duration-200 */
}

.dark .dropdown-icon {
    color: #6b7280 !important; /* dark:text-gray-500 */
}

.dropdown-icon.rotated {
    transform: rotate(180deg) !important; /* rotate-180 */
}

/* Card System */
.card {
    background-color: #ffffff !important; /* bg-primary */
    border-radius: 0.75rem !important; /* rounded-xl */
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important; /* shadow-lg */
    border: 1px solid #e5e7eb !important; /* border border-primary */
    padding: 1.5rem !important; /* p-6 */
}

.dark .card {
    background-color: #1f2937 !important; /* dark:bg-gray-800 */
    border-color: #374151 !important; /* dark:border-gray-700 */
}

.card-hover {
    transition: all 0.3s ease !important; /* transition-all duration-300 */
}

.card-hover:hover {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important; /* hover:shadow-xl */
    transform: translateY(-0.25rem) !important; /* hover:-translate-y-1 */
}

/* Button System */
.btn-icon {
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 2.5rem !important; /* w-10 */
    height: 2.5rem !important; /* h-10 */
    border: 1px solid #e5e7eb !important; /* border border-gray-200 */
    border-radius: 0.5rem !important; /* rounded-lg */
    background-color: #ffffff !important; /* bg-white */
    color: #4b5563 !important; /* text-gray-600 */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    cursor: pointer !important;
    font-size: 0.875rem !important; /* text-sm */
}

.btn-icon:hover {
    background-color: #f3f4f6 !important; /* hover:bg-gray-100 */
    color: #111827 !important; /* hover:text-gray-900 */
    border-color: #d1d5db !important; /* hover:border-gray-300 */
}

.dark .btn-icon {
    border-color: #374151 !important; /* dark:border-gray-700 */
    background-color: #1f2937 !important; /* dark:bg-gray-800 */
    color: #d1d5db !important; /* dark:text-gray-300 */
}

.dark .btn-icon:hover {
    background-color: #374151 !important; /* dark:hover:bg-gray-700 */
    color: #ffffff !important; /* dark:hover:text-white */
    border-color: #4b5563 !important; /* dark:hover:border-gray-600 */
}

/* Navbar Title */
.navbar-title {
    color: #111827 !important; /* text-primary */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    font-weight: 700 !important; /* font-bold */
    font-size: 1.25rem !important; /* text-xl */
}

.dark .navbar-title {
    color: #ffffff !important; /* dark:text-white */
}

/* Navbar Background */
.navbar {
    background-color: #ffffff !important; /* bg-white */
    border-bottom: 1px solid #e5e7eb !important; /* border-b border-gray-200 */
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06) !important; /* shadow-lg */
}

.dark .navbar {
    background-color: #1f2937 !important; /* dark:bg-gray-800 */
    border-bottom-color: #374151 !important; /* dark:border-gray-700 */
}

/* Mobile Navbar */
.mobile-navbar {
    background-color: #ffffff !important; /* bg-primary */
    border-bottom: 1px solid #e5e7eb !important; /* border-b border-primary */
}

.dark .mobile-navbar {
    background-color: #1f2937 !important; /* dark:bg-gray-800 */
    border-bottom-color: #374151 !important; /* dark:border-gray-700 */
}

/* Mobile Navbar Links */
.mobile-navbar .mobile-nav-link {
    display: block !important; /* block */
    padding: 0.5rem 0.75rem !important; /* px-3 py-2 */
    font-size: 1rem !important; /* text-base */
    font-weight: 500 !important; /* font-medium */
    color: #4b5563 !important; /* text-gray-600 */
    border-radius: 0.375rem !important; /* rounded-md */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    text-decoration: none !important;
    margin: 0.25rem 0 !important; /* space-y-1 */
}

.mobile-navbar .mobile-nav-link:hover {
    color: #111827 !important; /* hover:text-gray-900 */
    background-color: #f9fafb !important; /* hover:bg-gray-50 */
}

.dark .mobile-navbar .mobile-nav-link {
    color: #d1d5db !important; /* dark:text-gray-300 */
}

.dark .mobile-navbar .mobile-nav-link:hover {
    color: #ffffff !important; /* dark:hover:text-white */
    background-color: #374151 !important; /* dark:hover:bg-gray-700 */
}

.mobile-navbar .mobile-nav-link.active {
    color: #2563eb !important; /* text-primary-600 */
    background-color: #eff6ff !important; /* bg-primary-50 */
    border-right: 4px solid #2563eb !important; /* border-r-4 border-primary-600 */
}

.dark .mobile-navbar .mobile-nav-link.active {
    color: #60a5fa !important; /* dark:text-primary-400 */
    background-color: rgba(30, 58, 138, 0.2) !important; /* dark:bg-primary-900/20 */
    border-right-color: #60a5fa !important; /* dark:border-primary-400 */
}

/* Modal Button System */
.btn-primary {
    display: inline-flex !important;
    align-items: center !important;
    padding: 0.5rem 1rem !important; /* px-4 py-2 */
    border: 1px solid #3b82f6 !important; /* border border-blue-500 */
    border-radius: 0.5rem !important; /* rounded-lg */
    background-color: #3b82f6 !important; /* bg-blue-500 */
    color: #ffffff !important; /* text-white */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    font-size: 0.875rem !important; /* text-sm */
    font-weight: 500 !important; /* font-medium */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    cursor: pointer !important;
    text-decoration: none !important;
}

.btn-primary:hover {
    background-color: #2563eb !important; /* hover:bg-blue-600 */
    border-color: #2563eb !important; /* hover:border-blue-600 */
}

.dark .btn-primary {
    border-color: #60a5fa !important; /* dark:border-blue-400 */
    background-color: #3b82f6 !important; /* dark:bg-blue-500 */
    color: #ffffff !important; /* dark:text-white */
}

.dark .btn-primary:hover {
    background-color: #2563eb !important; /* dark:hover:bg-blue-600 */
    border-color: #2563eb !important; /* dark:hover:border-blue-600 */
}

.btn-secondary {
    display: inline-flex !important;
    align-items: center !important;
    padding: 0.5rem 1rem !important; /* px-4 py-2 */
    border: 1px solid #d1d5db !important; /* border border-gray-300 */
    border-radius: 0.5rem !important; /* rounded-lg */
    background-color: #ffffff !important; /* bg-white */
    color: #374151 !important; /* text-gray-700 */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    font-size: 0.875rem !important; /* text-sm */
    font-weight: 500 !important; /* font-medium */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    cursor: pointer !important;
    text-decoration: none !important;
}

.btn-secondary:hover {
    background-color: #f9fafb !important; /* hover:bg-gray-50 */
    border-color: #9ca3af !important; /* hover:border-gray-400 */
    color: #111827 !important; /* hover:text-gray-900 */
}

.dark .btn-secondary {
    border-color: #4b5563 !important; /* dark:border-gray-600 */
    background-color: #374151 !important; /* dark:bg-gray-700 */
    color: #d1d5db !important; /* dark:text-gray-300 */
}

.dark .btn-secondary:hover {
    background-color: #4b5563 !important; /* dark:hover:bg-gray-600 */
    border-color: #6b7280 !important; /* dark:hover:border-gray-500 */
    color: #ffffff !important; /* dark:hover:text-white */
}

.btn-danger {
    display: inline-flex !important;
    align-items: center !important;
    padding: 0.5rem 1rem !important; /* px-4 py-2 */
    border: 1px solid #dc2626 !important; /* border border-red-600 */
    border-radius: 0.5rem !important; /* rounded-lg */
    background-color: #dc2626 !important; /* bg-red-600 */
    color: #ffffff !important; /* text-white */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    font-size: 0.875rem !important; /* text-sm */
    font-weight: 500 !important; /* font-medium */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    cursor: pointer !important;
    text-decoration: none !important;
}

.btn-danger:hover {
    background-color: #b91c1c !important; /* hover:bg-red-700 */
    border-color: #b91c1c !important; /* hover:border-red-700 */
}

.dark .btn-danger {
    border-color: #f87171 !important; /* dark:border-red-400 */
    background-color: #dc2626 !important; /* dark:bg-red-600 */
    color: #ffffff !important; /* dark:text-white */
}

.dark .btn-danger:hover {
    background-color: #b91c1c !important; /* dark:hover:bg-red-700 */
    border-color: #b91c1c !important; /* dark:hover:border-red-700 */
}

.btn-success {
    display: inline-flex !important;
    align-items: center !important;
    padding: 0.5rem 1rem !important; /* px-4 py-2 */
    border: 1px solid #059669 !important; /* border border-green-600 */
    border-radius: 0.5rem !important; /* rounded-lg */
    background-color: #059669 !important; /* bg-green-600 */
    color: #ffffff !important; /* text-white */
    font-family: 'Cairo', sans-serif !important; /* font-cairo */
    font-size: 0.875rem !important; /* text-sm */
    font-weight: 500 !important; /* font-medium */
    transition: all 0.2s ease !important; /* transition-all duration-200 */
    cursor: pointer !important;
    text-decoration: none !important;
}

.btn-success:hover {
    background-color: #047857 !important; /* hover:bg-green-700 */
    border-color: #047857 !important; /* hover:border-green-700 */
}

.dark .btn-success {
    border-color: #4ade80 !important; /* dark:border-green-400 */
    background-color: #059669 !important; /* dark:bg-green-600 */
    color: #ffffff !important; /* dark:text-white */
}

.dark .btn-success:hover {
    background-color: #047857 !important; /* dark:hover:bg-green-700 */
    border-color: #047857 !important; /* dark:hover:border-green-700 */
}

/* Smooth transitions */
* {
    transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease !important;
}
</style>
