# إعداد رابط تحميل تطبيق Android

## نظرة عامة
تم إضافة موديل `AppConfig` في Django لإدارة إعدادات التطبيق العامة، بما في ذلك رابط تحميل تطبيق Android (APK).

## الميزات الرئيسية

### 1. موديل Django - AppConfig
- **الموقع**: `app/models.py`
- **الحقول**:
  - `apk_download_url`: حقل URLField لتخزين رابط تحميل APK
- **الخصائص**:
  - يسمح بسجل واحد فقط في قاعدة البيانات (Singleton Pattern)
  - متاح للأدمن فقط في لوحة التحكم
  - يتم إنشاؤه تلقائياً إذا لم يكن موجوداً

### 2. لوحة الأدمن
- **الموقع**: `app/admin.py`
- **الصلاحيات**:
  - يظهر فقط للأدمن في لوحة التحكم
  - لا يمكن إضافة أكثر من سجل واحد
  - لا يمكن حذف السجل الموجود
- **الواجهة**:
  - عرض مختصر للرابط في قائمة الإعدادات
  - وصف توضيحي للحقل

### 3. API Endpoint
- **المسار**: `/api/app-config/`
- **الطريقة**: `GET`
- **الصلاحيات**: متاح للجميع (بدون مصادقة)
- **الاستجابة**:
  ```json
  {
    "apk_download_url": "https://example.com/app.apk"
  }
  ```
  أو
  ```json
  {
    "apk_download_url": null
  }
  ```

### 4. التكامل مع Frontend
- **الموقع**: `frontend/src/pages/Auth.tsx`
- **الآلية**:
  - يتم جلب رابط APK تلقائياً عند تحميل صفحة المصادقة
  - يظهر زر التحميل فقط إذا كان الرابط متاحاً
  - لا حاجة لمتغيرات البيئة بعد الآن

## كيفية الاستخدام

### 1. الوصول إلى لوحة الأدمن
1. قم بتسجيل الدخول إلى لوحة الأدمن Django: `/admin/`
2. ابحث عن "إعدادات التطبيق" (AppConfig)
3. اضغط على السجل الموجود أو أنشئ واحداً جديداً

### 2. إضافة/تعديل رابط APK
1. في حقل "رابط تحميل تطبيق Android"، أدخل الرابط الكامل لملف APK
2. يمكن استخدام روابط من:
   - MediaFire: `https://www.mediafire.com/file/xxx/stockly.apk/file`
   - Google Drive: رابط مباشر للتحميل
   - أي موقع استضافة آخر
3. احفظ التغييرات

### 3. إزالة زر التحميل
- إذا كنت تريد إخفاء زر التحميل، فقط امسح محتوى حقل "رابط تحميل تطبيق Android" واحفظ

## Migration
تم إنشاء Migration تلقائي:
```bash
# Migration file
app/migrations/0015_appconfig.py
```

لتطبيق التغييرات على قاعدة البيانات:
```bash
python manage.py migrate app
```

## الأمان
- نقطة الوصول `/api/app-config/` متاحة للجميع (بدون مصادقة)
- هذا آمن لأنها تعرض فقط رابط عام للتحميل
- لوحة الأدمن محمية ومتاحة للأدمن فقط

## ملاحظات تقنية
- يستخدم Singleton Pattern لضمان سجل واحد فقط
- يتم إنشاء السجل تلقائياً عند أول استدعاء لـ `AppConfig.get_config()`
- الحقل يقبل روابط حتى 500 حرف
- يمكن أن يكون الحقل فارغاً (null/blank)

## أمثلة

### مثال 1: رابط MediaFire
```
https://www.mediafire.com/file/abc123xyz/stockly-v1.0.0.apk/file
```

### مثال 2: رابط مباشر
```
https://example.com/downloads/stockly.apk
```

### مثال 3: GitHub Release
```
https://github.com/username/stockly/releases/download/v1.0.0/stockly.apk
```

## استكشاف الأخطاء

### الزر لا يظهر في صفحة المصادقة
1. تأكد من أن الرابط موجود في لوحة الأدمن
2. افتح Developer Console في المتصفح وتحقق من:
   - طلب API: `/api/app-config/`
   - الاستجابة تحتوي على `apk_download_url`
3. تأكد من أن Frontend قيد التشغيل

### خطأ في API
- تحقق من أن Django Server قيد التشغيل
- تأكد من أن المسار `/api/app-config/` موجود في `app/urls.py`
- راجع سجلات Django للأخطاء

## التطوير المستقبلي
يمكن توسيع موديل `AppConfig` ليشمل:
- رابط تحميل iOS
- رقم إصدار التطبيق
- رسائل صيانة
- إعدادات عامة أخرى

## الدعم
للمزيد من المساعدة، راجع:
- `app/models.py` - تعريف الموديل
- `app/admin.py` - إعدادات لوحة الأدمن
- `app/api_v1.py` - API Endpoint
- `frontend/src/pages/Auth.tsx` - التكامل مع Frontend

